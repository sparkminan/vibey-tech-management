name: Dashboard Auto Update

on:
  schedule:
    - cron: '0 18 * * *'  # æ¯æ—¥18:00 JST
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  update-dashboard:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: read
      pull-requests: read
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: |
          npm install @octokit/rest
          
      - name: Update dashboard
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          node -e "
          const { Octokit } = require('@octokit/rest');
          const fs = require('fs');
          
          const octokit = new Octokit({ auth: process.env.GITHUB_TOKEN });
          
          async function updateDashboard() {
            const now = new Date().toLocaleString('ja-JP');
            
            // Issuesçµ±è¨ˆåé›†
            const { data: issues } = await octokit.rest.issues.listForRepo({
              owner: 'sparkminan',
              repo: 'vibey-tech-management',
              state: 'all',
              per_page: 100
            });
            
            const openIssues = issues.filter(i => i.state === 'open').length;
            const closedIssues = issues.filter(i => i.state === 'closed').length;
            const epicIssues = issues.filter(i => i.labels.some(l => l.name.includes('epic'))).length;
            const riskIssues = issues.filter(i => i.labels.some(l => l.name.includes('risk'))).length;
            
            const dashboard = \`# Vibey Technologies - Master Dashboard
          
          æœ€çµ‚æ›´æ–°: \${now}
          
          > ã“ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯GitHub Actionsã«ã‚ˆã‚Šè‡ªå‹•æ›´æ–°ã•ã‚Œã¦ã„ã¾ã™
          
          ## ğŸ“Š çµ±åˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
          
          ### ğŸ“‹ Issueçµ±è¨ˆ
          - **ã‚ªãƒ¼ãƒ—ãƒ³Issues**: \${openIssues}
          - **ã‚¯ãƒ­ãƒ¼ã‚ºIssues**: \${closedIssues}
          - **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ”ãƒƒã‚¯**: \${epicIssues}
          - **ç®¡ç†ä¸­ãƒªã‚¹ã‚¯**: \${riskIssues}
          
          ### ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³
          
          | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | GitHub | Issues | Status |
          |------------|--------|--------|--------|
          | [Claude Code Remote](https://github.com/sparkminan/claude-code-remote) | ğŸ”— | [Issues](https://github.com/sparkminan/claude-code-remote/issues) | ğŸš§ é–‹ç™ºä¸­ |
          | [HENKAKU AI Archive](https://github.com/sparkminan/henkaku-ai-archive) | ğŸ”— | [Issues](https://github.com/sparkminan/henkaku-ai-archive/issues) | âœ… ã‚¢ã‚¯ãƒ†ã‚£ãƒ– |
          
          ## ğŸš¨ ä»Šé€±ã®é‡è¦äº‹é …
          
          ### ğŸ”¥ ç·Šæ€¥å¯¾å¿œãŒå¿…è¦
          - Claude Code Remote: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ï¼ˆHTTPS/WSSå®Ÿè£…ï¼‰
          - ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰ï¼ˆiPhoneå®Ÿæ©Ÿèª¿é”ï¼‰
          
          ### âš¡ é«˜å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯
          - çµ±åˆãƒ†ã‚¹ãƒˆè¨ˆç”»å®Ÿè¡Œï¼ˆ8/4-8/16ï¼‰
          - å“è³ªå‘ä¸Šã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³å®Ÿè£…
          - GitHub Projectsæœ¬æ ¼é‹ç”¨é–‹å§‹
          
          ## ğŸ“ˆ å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹
          
          ### é–‹ç™ºå“è³ªç›®æ¨™
          - **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: ç›®æ¨™85%
          - **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢**: ç›®æ¨™A+
          - **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: Lighthouse 95+
          
          ## ğŸ”— ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹
          
          ### ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
          - [çµ±ä¸€é–‹ç™ºæ¨™æº–](./UNIFIED_DEVELOPMENT_STANDARDS.md)
          - [å“è³ªæ”¹å–„ã‚¬ã‚¤ãƒ‰](./QUALITY_IMPROVEMENT_GUIDE.md)
          - [ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](./CODE_QUALITY_CHECKLIST.md)
          
          ### ğŸ“Š ç®¡ç†ãƒ„ãƒ¼ãƒ«
          - [GitHub Projects](https://github.com/sparkminan/vibey-tech-management/projects)
          - [Issues](https://github.com/sparkminan/vibey-tech-management/issues)
          - [Discussions](https://github.com/sparkminan/vibey-tech-management/discussions)
          
          ---
          
          *ã“ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯æ¯æ—¥18:00ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™*
          \`;
            
            fs.writeFileSync('dashboards/MASTER_DASHBOARD.md', dashboard);
            console.log('Dashboard updated successfully');
          }
          
          updateDashboard().catch(console.error);
          "
          
      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add dashboards/MASTER_DASHBOARD.md
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "ğŸ“Š Auto-update dashboard - $(date +'%Y-%m-%d %H:%M')"
            git push
          fi