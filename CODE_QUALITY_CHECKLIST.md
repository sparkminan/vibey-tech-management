# コード品質チェックリスト

**Version**: 1.0  
**適用範囲**: 全プロジェクト  
**最終更新**: 2025年8月3日

---

## 📋 使用方法

このチェックリストは以下の場面で使用します：
- **PR作成時**: 開発者による自己チェック
- **コードレビュー時**: レビュアーによる確認
- **リリース前**: 最終品質確認

各項目は必須（🔴）、推奨（🟡）、参考（🟢）に分類されています。

---

## 🛡 セキュリティチェック

### 認証・認可
- [ ] 🔴 **環境変数使用**: 認証情報をハードコードしていない
- [ ] 🔴 **パスワードハッシュ化**: bcrypt等で適切にハッシュ化
- [ ] 🔴 **JWT管理**: 適切な有効期限とシークレット管理
- [ ] 🔴 **HTTPS/WSS**: 本番環境で暗号化通信を使用

```typescript
// ❌ 悪い例
const password = "admin123";
const JWT_SECRET = "secret";

// ✅ 良い例  
const password = await bcrypt.hash(userInput, 12);
const JWT_SECRET = process.env.JWT_SECRET || throwError();
```

### 入力検証
- [ ] 🔴 **バリデーション**: 全ての入力に対してバリデーション実装
- [ ] 🔴 **SQLインジェクション対策**: パラメータ化クエリを使用
- [ ] 🔴 **XSS対策**: 出力時のエスケープ処理
- [ ] 🟡 **ファイルアップロード**: 適切な制限とウイルスチェック

```typescript
// ✅ 入力バリデーション例
const schema = Joi.object({
  email: Joi.string().email().required(),
  command: Joi.string().max(500).pattern(/^[a-zA-Z0-9\s\-\.]+$/)
});
```

### 通信セキュリティ
- [ ] 🔴 **CORS設定**: 適切なオリジン制限
- [ ] 🔴 **Rate Limiting**: API呼び出し制限
- [ ] 🟡 **CSP設定**: Content Security Policy実装
- [ ] 🟡 **セキュリティヘッダー**: Helmet.js等の使用

---

## 🧪 テスト品質チェック

### ユニットテスト
- [ ] 🔴 **カバレッジ**: 最低80%のコードカバレッジ
- [ ] 🔴 **テストケース**: 正常系・異常系・境界値テスト
- [ ] 🟡 **モック使用**: 外部依存をモック化
- [ ] 🟡 **テスト名**: 分かりやすいテスト名

```typescript
// ✅ 良いテスト例
describe('validateCommand', () => {
  it('should accept valid git commands', () => {
    expect(validateCommand('git status')).toBe(true);
  });
  
  it('should reject dangerous commands', () => {
    expect(() => validateCommand('rm -rf /')).toThrow();
  });
});
```

### 統合テスト
- [ ] 🔴 **API テスト**: 主要APIエンドポイントのテスト
- [ ] 🟡 **データベーステスト**: データ整合性確認
- [ ] 🟡 **外部サービステスト**: Airtable等の連携テスト

### E2Eテスト
- [ ] 🔴 **クリティカルパス**: 主要ユーザーフローのテスト
- [ ] 🟡 **クロスブラウザ**: Chrome、Safari、Firefoxでのテスト
- [ ] 🟡 **レスポンシブ**: モバイル・タブレット対応確認

---

## 💻 コード品質チェック

### 可読性・保守性
- [ ] 🔴 **命名規約**: 一貫性のある命名
- [ ] 🔴 **関数サイズ**: 1関数50行以内（複雑な処理除く）
- [ ] 🔴 **重複排除**: DRY原則の遵守
- [ ] 🟡 **コメント**: 複雑なロジックへのコメント

```typescript
// ✅ 良い命名例
const fetchUserProfile = async (userId: string): Promise<UserProfile> => {
  const validatedId = validateUserId(userId);
  return await userRepository.findById(validatedId);
};
```

### TypeScript品質
- [ ] 🔴 **型安全性**: `any`型の使用を最小限に
- [ ] 🔴 **null安全性**: 適切なnullチェック
- [ ] 🟡 **型定義**: インターフェース・型の適切な定義
- [ ] 🟡 **ジェネリクス**: 再利用可能な型定義

```typescript
// ❌ 悪い例
function processData(data: any): any {
  return data.map((item: any) => item.value);
}

// ✅ 良い例
interface DataItem {
  id: string;
  value: number;
}

function processData<T extends DataItem>(data: T[]): number[] {
  return data.map(item => item.value);
}
```

### パフォーマンス
- [ ] 🔴 **メモリリーク**: 適切なリソース解放
- [ ] 🟡 **非同期処理**: Promise/async-awaitの適切な使用
- [ ] 🟡 **最適化**: 不要な再レンダリング防止
- [ ] 🟢 **バンドルサイズ**: 不要なライブラリの排除

---

## 🎨 UI/UX品質チェック

### アクセシビリティ
- [ ] 🔴 **キーボード操作**: 全機能がキーボードで操作可能
- [ ] 🔴 **alt属性**: 画像に適切なalt属性
- [ ] 🟡 **ARIA属性**: 適切なARIAラベル
- [ ] 🟡 **コントラスト**: WCAG 2.1 AA基準準拠

```jsx
// ✅ アクセシブルなボタン例
<button
  aria-label="コマンドを実行"
  onClick={handleExecute}
  disabled={isLoading}
>
  {isLoading ? '実行中...' : '実行'}
</button>
```

### レスポンシブデザイン
- [ ] 🔴 **モバイル対応**: iPhone、Androidでの表示確認
- [ ] 🔴 **タッチ操作**: 適切なタッチターゲットサイズ
- [ ] 🟡 **画面回転**: 縦横画面の対応
- [ ] 🟡 **SafeArea**: iPhone X以降のSafeArea対応

### パフォーマンス
- [ ] 🔴 **Lighthouse スコア**: 90以上
- [ ] 🔴 **画像最適化**: WebP、適切なサイズ
- [ ] 🟡 **遅延読み込み**: 重いコンテンツの遅延読み込み
- [ ] 🟡 **キャッシュ**: 適切なキャッシュ戦略

---

## 🚀 デプロイ・運用チェック

### 設定管理
- [ ] 🔴 **環境変数**: 本番・開発環境の適切な分離
- [ ] 🔴 **シークレット管理**: 機密情報の適切な管理
- [ ] 🟡 **設定ファイル**: 環境別の設定ファイル
- [ ] 🟡 **バージョン管理**: 適切なバージョニング

### 監視・ログ
- [ ] 🔴 **エラーログ**: 適切なエラーログ出力
- [ ] 🟡 **パフォーマンス監視**: レスポンス時間の監視
- [ ] 🟡 **ヘルスチェック**: 生存監視エンドポイント
- [ ] 🟢 **アラート設定**: 異常時の通知設定

```typescript
// ✅ 適切なログ出力例
logger.error('Command execution failed', {
  command: sanitizedCommand,
  userId: user.id,
  error: error.message,
  timestamp: new Date().toISOString()
});
```

---

## 📚 ドキュメント品質チェック

### コードドキュメント
- [ ] 🔴 **README更新**: セットアップ手順の最新化
- [ ] 🔴 **API仕様書**: OpenAPI/Swagger仕様
- [ ] 🟡 **JSDoc**: 公開関数・クラスのドキュメント
- [ ] 🟡 **型定義**: TypeScript型の説明

### 運用ドキュメント
- [ ] 🟡 **デプロイ手順**: 段階的なデプロイ手順書
- [ ] 🟡 **トラブルシューティング**: よくある問題と解決策
- [ ] 🟢 **アーキテクチャ図**: システム構成の図解

---

## 🔍 プロジェクト固有チェック

### Claude Code Remote
- [ ] 🔴 **コマンドホワイトリスト**: 危険なコマンドの制限
- [ ] 🔴 **WebSocket認証**: 接続時の適切な認証
- [ ] 🔴 **プロセス管理**: Claudeプロセスの適切な管理
- [ ] 🟡 **接続復旧**: 切断時の自動再接続

### HENKAKU AI Archive
- [ ] 🔴 **データ同期**: Airtableデータの整合性
- [ ] 🔴 **静的生成**: Next.js静的生成の最適化
- [ ] 🟡 **検索機能**: 日本語検索の精度
- [ ] 🟡 **SEO対策**: メタデータとサイトマップ

---

## ⚡ 緊急時チェック（セキュリティ・パフォーマンス）

### 緊急セキュリティチェック
- [ ] 🔴 **平文通信**: HTTP→HTTPS移行完了
- [ ] 🔴 **認証突破**: 認証迂回の可能性確認
- [ ] 🔴 **機密情報漏洩**: ログ・エラーメッセージの機密情報確認

### 緊急パフォーマンスチェック
- [ ] 🔴 **メモリリーク**: 長時間稼働時のメモリ使用量
- [ ] 🔴 **無限ループ**: 処理が停止しない可能性
- [ ] 🔴 **リソース枯渇**: CPU・メモリ・ネットワークの過度使用

---

## 📊 品質メトリクス確認

### 自動化チェック（CI/CD）
- [ ] 🔴 **Lint**: ESLint・Prettierエラーなし
- [ ] 🔴 **型チェック**: TypeScript型エラーなし
- [ ] 🔴 **テスト**: 全テストのパス
- [ ] 🔴 **ビルド**: エラーなしでビルド完了

### 手動確認項目
- [ ] 🟡 **Lighthouse監査**: パフォーマンス・アクセシビリティ
- [ ] 🟡 **セキュリティスキャン**: npm audit・Snyk
- [ ] 🟡 **依存関係**: 脆弱性のあるパッケージ確認

---

## ✅ 最終チェック（リリース直前）

### 機能確認
- [ ] 🔴 **主要機能**: 全ての主要機能が動作
- [ ] 🔴 **エラーハンドリング**: 異常系の適切な処理
- [ ] 🔴 **データ整合性**: データの破損・不整合がない

### 非機能確認
- [ ] 🔴 **パフォーマンス**: 要件スペック内で動作
- [ ] 🔴 **セキュリティ**: 脆弱性スキャン通過
- [ ] 🔴 **互換性**: ターゲット環境での動作確認

### ドキュメント確認
- [ ] 🔴 **CHANGELOG**: 変更履歴の更新
- [ ] 🔴 **バージョン**: パッケージバージョンの更新
- [ ] 🟡 **リリースノート**: ユーザー向け変更説明

---

## 🎯 品質スコア算出

### スコア計算
- **🔴 必須項目**: 1項目 = 10点
- **🟡 推奨項目**: 1項目 = 5点  
- **🟢 参考項目**: 1項目 = 2点

### 品質ランク
- **Aランク**: 90点以上（リリース可能）
- **Bランク**: 70-89点（改善推奨）
- **Cランク**: 50-69点（要改善）
- **Dランク**: 50点未満（リリース不可）

---

## 📞 サポート・質問

### 品質に関する相談
- **GitHub Discussion**: 技術的な質問
- **Slack #quality**: 日常的な相談
- **PM報告**: 品質リスクの報告

### 例外申請
特別な事情で基準を満たせない場合：
1. **GitHub Issue**で理由と代替案を提示
2. **品質委員会**での審議
3. **PM承認**による例外許可

---

**このチェックリストは継続的に改善されます。新しい要件や課題があれば、積極的にフィードバックをお寄せください。**